import pandas as pd
from sqlalchemy import create_engine
from sqlalchemy.exc import SQLAlchemyError

def csv_to_sqlserver():
    try:
        csv_path = r"C:\Users\Администратор\Desktop\python\RASS\ProductBonus.csv"

        server = "localhost\\SQLEXPRESS"
        database = "AdventureWorks2022"
        table_name = "my_table"

        df = pd.read_csv(csv_path)
        print("✅ CSV faylı uğurla oxundu.")

        connection_string = (
            f"mssql+pyodbc://{server}/{database}"
            "?driver=ODBC+Driver+17+for+SQL+Server&trusted_connection=yes"
        )

        engine = create_engine(connection_string)
        print("🔗 SQL Server-ə bağlantı quruldu.")

        df.to_sql(table_name, con=engine, if_exists="append", index=False)
        print("✅ CSV məlumatları MSSQL-ə uğurla əlavə olundu!")

    except FileNotFoundError:
        print("❌ CSV faylı tapılmadı. Zəhmət olmasa yolun düzgünlüyünü yoxlayın.")
    except pd.errors.ParserError:
        print("❌ CSV faylında sintaksis xətası var. Faylı yoxlayın.")
    except SQLAlchemyError as e:
        print(f"❌ SQL Server bağlantısı və ya yazma zamanı xəta baş verdi:\n{e}")
    except Exception as e:
        print(f"❌ Gözlənilməz xəta baş verdi:\n{e}")

csv_to_sqlserver()
